if(ZenviaChat)throw new Error("Skipping duplicated zenvia-chat.js loading!");var ZenviaChat=function(e,t,n){function a(e){var t=new RegExp("^[^:]+://([^?:/#]+)(:[0-9]+)?(/[^?#]*)?([?]([^#]*))?(#.*)?$"),n={url:e,hostname:"",path:"",rawQueryParams:"",queryParams:{}};try{var a=t.exec(e);void 0!==a[1]&&(n.hostname=a[1]),void 0!==a[3]&&(n.path=a[3]),void 0!==a[4]&&a[4].length>0&&(n.rawQueryParams=a[4].substr(1),n.queryParams=function(e){var t={};return e.split("&").forEach(function(e){if(""!=e){var n=e.split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}}),t}(a[5]))}catch(e){}return n}function i(e,t){return"embeddedConfiguration"in S&&void 0===e&&(e=void 0===S.embeddedConfiguration.continuousConversation||S.embeddedConfiguration.continuousConversation),t||!1===e||(t=function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var i=n[a];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}("_zid")),t||(t=function(e,t){var n,a,i,o,r,s,d,c;n=3&e.length,a=e.length-n,i=t||Date.now(),r=3432918353,s=461845907,c=0;for(;c<a;)d=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=d=(65535&(d=(d=(65535&d)*r+(((d>>>16)*r&65535)<<16)&4294967295)<<15|d>>>17))*s+(((d>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(d=0,n){case 3:d^=(255&e.charCodeAt(c+2))<<16;break;case 2:d^=(255&e.charCodeAt(c+1))<<8;break;case 1:d^=255&e.charCodeAt(c),i^=d=(65535&(d=(d=(65535&d)*r+(((d>>>16)*r&65535)<<16)&4294967295)<<15|d>>>17))*s+(((d>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i^=i>>>16,i=2246822507*(65535&i)+((2246822507*(i>>>16)&65535)<<16)&4294967295,i^=i>>>13,i=3266489909*(65535&i)+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}(Math.random()),!1!==e&&(document.cookie="_zid="+t+";SameSite=Lax;Secure")),t}function o(e){return R?r():s(),this}function r(e){return P=!1,R=!1,x.classList.remove("znv-is-active"),this}function s(e){if(!O&&!R)return P=!0,this;R=!0,Z||d(),x.classList.add("znv-is-active");var t=x.getElementsByClassName("znv-opt-in");return t.length>0&&x.removeChild(t[0]),this}function d(){if(Z=!0,"room"===g&&(x.classList.add("znv-is-inline"),x.classList.add("znv-is-active")),c())l();else if(0===x.getElementsByTagName("iframe").length){var e=document.createElement("div");e.classList.add("znv-chat-container");var t="";void 0!==C&&(t+="width: "+C+";"),void 0!==y&&(t+="height: "+y+";"),e.setAttribute("style",t);var n=document.createElement("iframe");n.addEventListener("load",function(){setTimeout(l,1e3)}),n.classList.add("znv-iframe"),n.setAttribute("src",T+"/chat/"+A+"?utm_campaign=embedded&utm_source="+window.location.host+"&source=embedded"),n.setAttribute("frameborder","0"),n.setAttribute("width","100%"),n.setAttribute("height","100%");var a=document.createElement("div");a.classList.add("znv-chat-header"),a.style.backgroundColor=w;var i=document.createElement("div");i.classList.add("znv-chat-header-close"),i.addEventListener("click",r),a.appendChild(i),e.appendChild(a),e.appendChild(n),x.appendChild(e)}}function c(){return"mobile"===j&&"room"!==g}function u(){c()&&(window.location.href=T+"/chat/"+A+"?utm_campaign=embedded&utm_source="+window.location.host+"&source=embedded")}function l(){if(M)u();else{M=!0;var e={};"json"==L?e.dataKey=z:e.text=z;h(e,T+"/api/rooms/"+A+"/messages",u,u)}}function h(e,t,n,a){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===this.readyState&&(201===this.status?n&&n(JSON.parse(i.responseText)):a&&a(JSON.parse(i.responseText)))},i.open("POST",t,!0),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e))}function m(){if(B)throw new Error("This ZenviaChat instance have already been built!");return!1}function v(e){return m(),e&&((x=document.getElementById(e))||((x=document.createElement("div")).id=e,document.body?document.body.appendChild(x):document.documentElement.appendChild(x)),x.classList.add("znv-chat")),this}function f(e){return m(),f=e,this}function p(e){return m(),I=e,this}function b(e){return m(),b=e,this}var g,C,y,w,E,z,L,k,x,A,S,T="https://chat.zenvia.com",N=e,f=t,I=n,B=!1,O=!1,P=!1,M=!1,R=!1,Z=!1,j=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"mobile":"desktop",q=void 0,H=a(window.location.href);return H.referrer=a(document.referrer),{toggle:o,close:r,open:s,useCookie:f,user:p,uid:p,containerId:v,embedded:function(e){return m(),g=e,this},button:function(e){return m(),z=e,this},format:function(e){return m(),L=e,this},width:function(e){return m(),C=e,this},height:function(e){return m(),y=e,this},color:function(e){return m(),w=e,this},buttonColor:b,message:function(e){return m(),k=e,this},extraData:function(e){return m(),e&&"function"!=typeof e&&(q=e),this},build:function(e){if(m(),function(){if(!ZenviaChat.loadedStyles){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","https://static.zenvia.com/embed/css/zenvia-chat.min.css"),document.getElementsByTagName("head")[0].appendChild(e),ZenviaChat.loadedStyles=!0}}(),!N)throw new Error("Please, inform channelId to load a chatbot.");e&&(v(e),B=!0);var t=this,n=new XMLHttpRequest;return n.onreadystatechange=function(){if(4===this.readyState&&(200===this.status||304===this.status)){if(S=JSON.parse(n.responseText),!x){var e=0,a=document.getElementsByClassName("znv-chat");if(a)for(;e<a.length;e++)if(!a[e].zenviaChat){x=a[e],B=!0;break}x||(v("znv-chat-auto-"+e),B=!0)}if(x.zenviaChat)throw new Error("It is not possible to use the same div id for more than one ZenviaChat!");x.zenviaChat=t,I=i(f,I||x.dataset.uid||x.dataset.user);("#debug"==window.location.hash||window.location.search&&window.location.search.match(/[?&]debug(?=$|&)/))&&console.log("Chat-Id: "+N+"\nUser-Id: "+I),function(e){H.extra=q,h({from:N,to:[I],content:[],website:H},T+"/api/rooms/messages",function(t){A=t.roomId;var n=new XMLHttpRequest;n.onreadystatechange=function(){4===this.readyState&&(200!==this.status&&304!==this.status||((t=JSON.parse(n.responseText)).sessionStarted&&(M=!0),e(t)))},n.open("GET",T+"/api/rooms/"+A+"?enriched=true",!0),n.send()})}(function(e){if(void 0===(g=g||x.dataset.embedded)&&(g=M?"button":"button+keyword"),void 0===(C=C||x.dataset.width)&&"room"==g&&(C="100%"),C||(e.extra.brand.styles.dimension&&(C=e.extra.brand.styles.dimension.width),C||(C="400px")),void 0===(y=y||x.dataset.height)&&"room"==g&&(y="100%"),y||(e.extra.brand.styles.dimension&&(y=e.extra.brand.styles.dimension.height),y||(y="567px")),!(w=w||x.dataset.color)){try{w=e.extra.brand.styles.colors.primary}catch(e){console.error("Error loading brand primary color!",e)}w||(w="#333")}if(!(E=E||x.dataset.buttonColor)){try{E=e.extra.brand.styles.colors.button}catch(e){console.error("Error loading brand button color!",e)}if(!E)try{E=e.extra.brand.styles.colors.primary}catch(e){console.error("Error loading brand button color!",e)}E||(E="#333")}if(k=k||x.dataset.message,z=z||x.dataset.button||"ComeÃ§ar",L=L||x.dataset.format,"room"===g)L=L||"json",d(),O=!0;else if("buttonless"===g)L=L||"json",O=!0;else{if("button"!==g&&"button+keyword"!==g)throw new Error("Unsupported ZenviaChat type: "+g);k&&(g="button+keyword");var t=document.createElement("div");t.classList.add("znv-float-button"),t.style.backgroundColor=E,"button"===g?(L=L||"json",t.addEventListener("click",o),x.appendChild(t),O=!0):(L=L||"text",t.addEventListener("click",function(e){!function(){if(0===x.getElementsByClassName("znv-opt-in").length&&!Z){var e=document.createElement("div");e.classList.add("znv-opt-in");var t=document.createElement("a");if(t.classList.add("znv-opt-in-link"),t.innerHTML=z,t.style.color=w,t.addEventListener("click",function(e){if(this.getAttribute("disabled"))return!1;this.setAttribute("disabled","disabled"),d(),x.removeChild(x.getElementsByClassName("znv-opt-in")[0])}),k){var n=document.createElement("p");n.classList.add("znv-opt-in-text"),n.innerHTML=k;var a=document.createElement("div");a.classList.add("znv-opt-in-close"),a.addEventListener("click",r),e.appendChild(a),e.appendChild(n)}e.appendChild(t),x.appendChild(e)}}(),x.classList.toggle("znv-is-active")}),O=!0,x.appendChild(t),k&&t.click())}P&&(P=!1,s())})}},n.open("GET",T+"/api/backend/brand/name/"+N,!0),n.send(),this},destroy:function(){if(B&&x&&x.zenviaChat===this){for(r();x.hasChildNodes();)x.removeChild(x.lastChild);x.zenviaChat=void 0}}}};
//# sourceMappingURL=zenvia-chat.min.js.map

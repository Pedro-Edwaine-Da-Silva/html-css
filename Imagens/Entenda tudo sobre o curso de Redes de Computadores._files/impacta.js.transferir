(()=>{"use strict";const e="home",t="cart",a="order",r="profile",o={[e]:"home",product:"product-view",category:"category-view",[t]:"cart",[a]:"order"};class n{constructor(){this.handlers={},this.data={}}init(){window._crmbackData=window._crmbackData||{pageType:null,pageData:null};try{this.time=(new Date).getTime(),this.page=String(location.href),this.watchLocation();const e=this.time,t=this.getPageType(),a=this.getPageHandler(t);this.track(t,a,e)}catch(e){console.log("Helper: error on init")}try{"function"==typeof this.createCart&&(window.crmbackCreateCart=this.createCart.bind(this))}catch(e){}}track(e,t,a){if(a!==this.time)return window._crmbackData.pageType=null,window._crmbackData.pageData=null,void console.log("Helper: restart track (page changed)");try{if(e&&(window._crmbackData.pageType=e),t){const a=t.getPageData(),r=o?.[e];r&&(window._crmbackData.eventType=r),a&&r&&(JSON.stringify(this.data)===JSON.stringify(a)&&window._crmbackData.pageData||(window._crmbackData.pageData=a,window.crmback("event").setEvent(r,a),this.data=a))}}catch(e){console.log("Helper: error on extract data (track)",e)}try{this.checkCustomerData()}catch(e){console.log("Helper: error on check customer data (track)",e)}setTimeout((()=>{this.track(e,t,a)}),1e3)}async checkCustomerData(){const e=this.getCustomerHandler();if(e){try{"function"==typeof e?.businessRules&&e.businessRules()}catch(e){console.log("Helper: error on run business rules (track)",e)}try{const t=localStorage.getItem("crmb-customer-checked")||0;if(Date.now()-t>=864e5&&"function"==typeof e?.extractData){const t=await e.extractData();t?.email&&window.crmback("customer").setIdentification("email",t.email),t?.phone&&window.crmback("customer").setIdentification("phone",t.phone),t?.document&&window.crmback("customer").setIdentification("document",t.document),t?.name&&window.crmback("customer").setName(t.name),localStorage.setItem("crmb-customer-checked",Date.now())}}catch(e){console.log("Helper: error on extract customer data (track)",e)}}}getPageType(){throw new Error("getPageType method must be implemented.")}getPageHandler(e){try{if(!e)return;return this.handlers?.[e]||null}catch(e){console.log("Helper: error on get page handler")}}getCustomerHandler(){try{return this.handlers?.customer||null}catch(e){console.log("Helper: error on get customer data handler")}}registerHandler(e,t){this.handlers[e]=t}watchLocation(){if(String(this.page)!==String(location.href)){this.time=(new Date).getTime(),this.page=String(location.href);const e=this.time,t=this.getPageType(),a=this.getPageHandler(t);this.track(t,a,e)}setTimeout((()=>{this.watchLocation()}),1e3)}}class c{handleData(e){if("object"==typeof e&&null!==e)if(Array.isArray(e))for(let t=0;t<e.length;t++)this.handleData(e[t]);else for(let t in e)e.hasOwnProperty(t)&&("object"==typeof e[t]&&null!==e[t]?this.handleData(e[t]):["price","total"].includes(t)?e[t]=parseFloat(e[t]):isNaN(e[t])||null===e[t]||(e[t]=e[t].toString()))}getPageData(){const e=this.extractData();return e&&this.handleData(e),e}}class i extends c{extractData(){return this.extractDataFromDatalayer()}extractDataFromDatalayer(){const e=window.top.document.querySelector(".hero__intro__curso"),t=window.top.document.querySelector(".formacao-contorno");if(e){const e=window.top.document.querySelector(".item__info__val span"),t=window.top.document.querySelector(".hero__intro__curso h1").innerText;if(e)return{code:location.pathname.replace("/",""),checkout_url:window.top.location.href,items:[{pid:this.getSlug(t),name:t,quantity:1,link:window.top.location.href,image:window.top.document.querySelector(".hero img").src||"https://fakeimg.pl/300/",price:Number(e.innerText.replace("R$","").replace(/([\.])/g,"").replace(/([,])/g,".").replace(/[^0-9-.-]/g,""))}],total:Number(e.innerText.replace("R$","").replace(/([\.])/g,"").replace(/([,])/g,".").replace(/[^0-9-.-]/g,""))}}if(t){const e=window.top.document.querySelector("#ComprarAgora .preco"),t=window.top.document.querySelector(".formacao-contorno .title").innerText;if(e)return{code:location.pathname.replace("/",""),checkout_url:window.top.location.href,items:[{pid:this.getSlug(t),name:t,quantity:1,link:window.top.location.href,image:"https://fakeimg.pl/300/",price:Number(e.innerText.replace("R$","").replace(/([\.])/g,"").replace(/([,])/g,"."))}],total:Number(e.innerText.replace("R$","").replace(/([\.])/g,"").replace(/([,])/g,"."))}}return null}getSlug(e){return e.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}getTotal(e){return e.reduce(((e,t)=>e+t.price*t.quantity),0)}}class l extends c{extractData(){return this.extractDataFromDatalayer()}extractDataFromDatalayer(){const e=window.top.dataLayer.filter((e=>"TransactionPage"===e.PageType));if(e.length){const t=e[0].actionField;if(t)return{code:t.id,total:t.revenue}}return null}}class s extends c{extractData(){return this.extractDataFromDatalayer()}extractDataFromDatalayer(){const e=window.top.document.querySelector(".personal-data div input"),t=window.top.document.querySelector("#signup div input");return e&&e.id.includes("nomecompleto")?(window.top.crmback("customer").setName(e.value),e.addEventListener("blur",(()=>{window.top.crmback("customer").setName(e.value)})),{name:e.value}):t&&t.id.includes("nomecompleto")?(window.top.crmback("customer").setName(t.value),t.addEventListener("blur",(()=>{window.top.crmback("customer").setName(t.value)})),{name:t.value}):null}}new class extends n{constructor(){super(),this.registerHandler(t,new i),this.registerHandler(a,new l),this.registerHandler(r,new s),this.init()}getPageType(){return"/"===location.pathname?e:window.top.document.querySelector(".hero__intro__curso")||window.top.document.querySelector(".formacao-contorno")?t:"/pagamento-gerado"===window.top.location.pathname?a:"/inscricao"===window.top.location.pathname||"/login"===window.top.location.pathname?r:void 0}}})();